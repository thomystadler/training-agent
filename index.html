<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Training Agent</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    import { Activity } from 'https://esm.sh/lucide-react@0.263.1';

    const CONFIG = {
      WORKER_URL: 'https://intervals-icu-proxy.thomystadler.workers.dev',
      DEFAULT_API_KEY: '3zemjjfaoba8649t72snopm65',
      DEFAULT_ATHLETE_ID: 'i177384'
    };

    function TrainingAgent() {
      const [apiKey, setApiKey] = useState(CONFIG.DEFAULT_API_KEY);
      const [athleteId, setAthleteId] = useState(CONFIG.DEFAULT_ATHLETE_ID);
      const [isConnected, setIsConnected] = useState(false);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [athleteData, setAthleteData] = useState(null);

      const callAPI = async (endpoint) => {
      const url = `${CONFIG.WORKER_URL}/proxy${endpoint}`;
      console.log('ðŸ” Calling:', url);
      console.log('ðŸ”‘ API Key:', apiKey ? 'Present' : 'Missing');
      
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'X-API-Key': apiKey,
          'Accept': 'application/json'
        }
      });
      
      console.log('ðŸ“¡ Response status:', response.status);
      
      if (!response.ok) {
        const errorText = await response.text();
        console.error('âŒ Error:', errorText);
        throw new Error(`API Error ${response.status}: ${errorText}`);
      }
  
  const data = await response.json();
  console.log('âœ… Data received:', data);
  
  return data;
};
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`API Error ${response.status}: ${errorText}`);
        }
        
        return await response.json();
      };

      const connectToAPI = async () => {
        setLoading(true);
        setError('');
        
        try {
          const athlete = await callAPI(`/api/v1/athlete/${athleteId}`);
          setAthleteData(athlete);
          setIsConnected(true);
        } catch (err) {
          setError(err.message);
          setIsConnected(false);
        } finally {
          setLoading(false);
        }
      };

      if (!isConnected) {
        return React.createElement('div', {
          className: 'min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4'
        },
          React.createElement('div', {
            className: 'bg-slate-800 rounded-xl shadow-2xl p-8 max-w-md w-full border border-slate-700'
          },
            React.createElement('div', { className: 'text-center mb-6' },
              React.createElement(Activity, { className: 'w-16 h-16 text-blue-400 mx-auto mb-4' }),
              React.createElement('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'Training Agent'),
              React.createElement('p', { className: 'text-slate-400' }, 'Ultra Endurance Coach')
            ),
            React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-slate-300 mb-2' }, 'Athlete ID'),
                React.createElement('input', {
                  type: 'text',
                  value: athleteId,
                  onChange: (e) => setAthleteId(e.target.value),
                  className: 'w-full bg-slate-700 text-white px-4 py-2 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none'
                })
              ),
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium text-slate-300 mb-2' }, 'API Key'),
                React.createElement('input', {
                  type: 'password',
                  value: apiKey,
                  onChange: (e) => setApiKey(e.target.value),
                  className: 'w-full bg-slate-700 text-white px-4 py-2 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none'
                })
              ),
              error && React.createElement('div', {
                className: 'bg-red-900/30 border border-red-700 text-red-300 px-4 py-3 rounded-lg text-sm flex items-start'
              }, error),
              React.createElement('button', {
                onClick: connectToAPI,
                disabled: loading,
                className: 'w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50'
              }, loading ? 'Verbinde...' : 'Verbinden')
            )
          )
        );
      }

      return React.createElement('div', {
        className: 'min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-8'
      },
        React.createElement('div', { className: 'max-w-4xl mx-auto' },
          React.createElement('h1', { className: 'text-4xl font-bold mb-8' }, 'Training Agent'),
          React.createElement('div', { className: 'bg-slate-800 rounded-xl p-6 border border-slate-700' },
            React.createElement('h2', { className: 'text-2xl font-bold mb-4 flex items-center' },
              React.createElement('span', { className: 'mr-2' }, 'âœ…'),
              'Verbunden!'
            ),
            React.createElement('div', { className: 'space-y-2 text-lg' },
              React.createElement('p', null, `CTL (Fitness): ${athleteData?.ctl?.toFixed(0) || 'N/A'}`),
              React.createElement('p', null, `ATL (Fatigue): ${athleteData?.atl?.toFixed(0) || 'N/A'}`),
              React.createElement('p', null, `TSB (Form): ${athleteData?.yesterday_tsb?.toFixed(0) || 'N/A'}`)
            )
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(
      React.createElement(TrainingAgent)
    );
  </script>
</body>
</html>
